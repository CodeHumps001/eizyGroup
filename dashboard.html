<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes, viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="theme-color" content="#1e6fb3" />
    <title>Dashboard ‚Äî eizyGroup</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body id="app-body">
    <header class="site-header dashboard-header">
      <div class="container header-inner">
        <div class="logo">
          <span class="logo-icon" aria-hidden="true"> üßë‚Äçü§ù‚Äçüßë </span>
          <span class="logo-text">eizyGroup</span>
        </div>
        <div class="header-actions">
          <div class="user-info">
            <div class="user-details">
              <div id="user-name-display" class="user-name"></div>
              <div id="user-joined-display" class="user-joined"></div>
            </div>
          </div>
          <button class="btn-icon" id="theme-toggle" title="Toggle dark mode">
            <span id="theme-icon">üåô</span>
          </button>
          <a
            href="#"
            id="nav-logout-btn"
            class="btn btn-small"
            style="
              padding: 8px 10px;
              border: 1px solid #35449e;
              color: red;
              font-weight: bolder;
            "
            onclick="logout(); return false;"
            >Logout</a
          >
        </div>
      </div>
    </header>

    <div class="dashboard-root" id="dashboard-root">
      <aside class="sidebar">
        <div class="sidebar-inner">
          <nav class="sidebar-nav">
            <button class="tab-btn active" data-tab="generator">
              Generator
            </button>
            <button class="tab-btn" data-tab="history">History</button>
            <button class="tab-btn" data-tab="settings">Settings</button>
            <button
              class="tab-btn logout-btn"
              data-tab="logout"
              onclick="logout(); return false;"
            >
              Logout
            </button>
          </nav>
        </div>
      </aside>

      <main class="dashboard-main">
        <!-- Generator Tab -->
        <section id="generator" class="panel tab-content active">
          <h2>Group Generator</h2>
          <div class="grid">
            <div class="card input-card">
              <label>Student Names (one per line)</label>
              <textarea
                id="students-input"
                placeholder="Alice\nBob\nCharlie\n..."
                rows="10"
              ></textarea>
              <div
                style="
                  margin-top: 12px;
                  background-color: #35449e;
                  width: 150px;
                  border-radius: 100px;
                "
              >
                <label for="csv-import" class="btn btn-small btn-ghost"
                  >üì• Import CSV</label
                >
                <input
                  type="file"
                  id="csv-import"
                  accept=".csv"
                  style="display: none"
                />
              </div>
            </div>

            <div class="card config-card">
              <label>Number of groups</label>
              <input type="number" id="num-groups" min="1" value="3" />
              <label>‚Äî or ‚Äî</label>
              <label>Students per group</label>
              <input
                type="number"
                id="students-per-group"
                min="1"
                placeholder="Auto"
              />
              <div class="actions">
                <button class="btn btn-primary" id="generate-btn">
                  Generate Groups
                </button>
              </div>
            </div>
          </div>

          <div class="results" id="results">
            <div class="welcome">
              Welcome! Paste student names and click "Generate Groups" to begin.
            </div>
          </div>

          <!-- Export button (shown when groups are generated) -->
          <div
            id="export-section"
            class="export-section"
            style="display: none; margin-top: 20px"
          >
            <button class="btn btn-primary" id="export-csv-btn">
              üì• Export as CSV
            </button>
          </div>
        </section>

        <!-- History Tab -->
        <section id="history" class="panel tab-content">
          <h2>Generation History</h2>
          <div id="history-list" class="history-list">
            <div class="welcome">
              No generations yet. Create groups in the Generator tab to see them
              here.
            </div>
          </div>
        </section>

        <!-- Settings Tab -->
        <section id="settings" class="panel tab-content">
          <h2>Settings</h2>
          <div class="settings-container">
            <div class="card settings-card">
              <h3>Account Information</h3>
              <div class="settings-item">
                <label class="settings-label">Name:</label>
                <span id="settings-name" class="settings-value"></span>
              </div>
              <div class="settings-item">
                <label class="settings-label">Email:</label>
                <span id="settings-email" class="settings-value"></span>
              </div>
              <div class="settings-item">
                <label class="settings-label">Member Since:</label>
                <span id="settings-joined" class="settings-value"></span>
              </div>
            </div>

            <div class="card settings-card">
              <h3>Preferences</h3>
              <div class="settings-item">
                <label class="settings-label">
                  <input type="checkbox" id="dark-mode-pref" />
                  Enable Dark Mode
                </label>
              </div>
              <div class="settings-item">
                <label class="settings-label">
                  <input type="checkbox" id="auto-save-pref" checked />
                  Auto-save group generations to history
                </label>
              </div>
            </div>

            <div class="card settings-card danger-zone">
              <h3>Data Management</h3>
              <div class="settings-item">
                <button class="btn btn-ghost" id="clear-history-btn">
                  Clear History
                </button>
                <p
                  style="
                    font-size: 0.85rem;
                    color: var(--muted);
                    margin: 8px 0 0;
                  "
                >
                  This will delete all saved group generations.
                </p>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Login Modal (shared) -->
    <div class="modal" id="login-modal" aria-hidden="true">
      <div class="modal-backdrop" id="modal-backdrop"></div>
      <div
        class="modal-panel"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modal-title"
      >
        <button class="modal-close" id="modal-close">√ó</button>
        <h3 id="modal-title">Sign In</h3>
        <form
          id="login-form"
          onsubmit="event.preventDefault(); onLoginSubmit();"
        >
          <label class="field">
            <span>Email</span>
            <input type="email" id="login-email" required />
          </label>
          <label class="field">
            <span>Password</span>
            <input type="password" id="login-password" required />
          </label>
          <div class="modal-actions">
            <button class="btn btn-primary" type="submit">Sign In</button>
            <button class="btn btn-ghost" type="button" id="modal-cancel">
              Cancel
            </button>
          </div>
        </form>
        <div class="modal-footer">
          Don't have an account?
          <a
            href="#"
            id="switch-to-signup"
            onclick="switchToSignup(); return false;"
            >Sign up</a
          >
        </div>
      </div>
    </div>

    <!-- Signup Modal (hidden by default) -->
    <div class="modal" id="signup-modal" aria-hidden="true">
      <div class="modal-backdrop" id="modal-backdrop-signup"></div>
      <div
        class="modal-panel"
        role="dialog"
        aria-modal="true"
        aria-labelledby="signup-title"
      >
        <button class="modal-close" id="modal-close-signup">√ó</button>
        <h3 id="signup-title">Create Account</h3>
        <form
          id="signup-form"
          onsubmit="event.preventDefault(); onSignupSubmit();"
        >
          <label class="field">
            <span>Full Name</span>
            <input type="text" id="signup-name" required />
          </label>
          <label class="field">
            <span>Email</span>
            <input type="email" id="signup-email" required />
          </label>
          <label class="field">
            <span>Password</span>
            <input type="password" id="signup-password" required />
          </label>
          <label class="field">
            <span>Confirm Password</span>
            <input type="password" id="signup-confirm" required />
          </label>
          <div class="modal-actions">
            <button class="btn btn-primary" type="submit">
              Create Account
            </button>
            <button
              class="btn btn-ghost"
              type="button"
              id="modal-cancel-signup"
            >
              Cancel
            </button>
          </div>
        </form>
        <div class="modal-footer">
          Already have an account?
          <a
            href="#"
            id="switch-to-login"
            onclick="switchToLogin(); return false;"
            >Sign in</a
          >
        </div>
      </div>
    </div>

    <script src="js/app.js"></script>
    <script>
      // Dashboard-specific auth check and initialization
      document.addEventListener("DOMContentLoaded", () => {
        if (!isLoggedIn()) {
          // Redirect to home if not logged in
          window.location.href = "index.html";
        } else {
          // Show user info
          const user = currentUser;
          const nameDisplay = document.getElementById("user-name-display");
          const joinedDisplay = document.getElementById("user-joined-display");

          if (nameDisplay && user) {
            nameDisplay.textContent = user.name || "User";
          }

          if (joinedDisplay) {
            const joinDate = user.joinDate
              ? new Date(user.joinDate).toLocaleDateString()
              : new Date().toLocaleDateString();
            joinedDisplay.textContent = `Joined: ${joinDate}`;
          }

          // Setup logout button
          const logoutBtn = document.getElementById("nav-logout-btn");
          if (logoutBtn) {
            logoutBtn.addEventListener("click", (e) => {
              e.preventDefault();
              logout();
            });
          }

          // Initialize theme toggle
          initThemeToggle();

          // Initialize CSV import
          initCSVImport();

          // Setup tab buttons
          const tabBtns = document.querySelectorAll(".tab-btn");
          tabBtns.forEach((btn) => {
            btn.addEventListener("click", () => {
              const tab = btn.getAttribute("data-tab");
              if (tab !== "logout") {
                switchTab(tab);
              }
            });
          });

          // Setup export CSV button
          const exportCsvBtn = document.getElementById("export-csv-btn");
          if (exportCsvBtn) {
            exportCsvBtn.addEventListener("click", exportGroupsAsCSV);
          }

          // Initialize the first tab
          switchTab("generator");
        }
      });
    </script>
  </body>
</html>
